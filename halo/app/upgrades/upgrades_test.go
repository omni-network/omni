package upgrades_test

import (
	"fmt"
	"testing"

	"github.com/omni-network/omni/halo/app/upgrades"
	"github.com/omni-network/omni/lib/tutil"
)

//go:generate go test . -golden

func TestGenStatic(t *testing.T) {
	t.Parallel()

	var names string
	for _, u := range upgrades.Upgrades {
		names += fmt.Sprintf("\t%q,\n", u.Name)
	}

	tpl := `// Code generated by upgrades/TestGenStatic; DO NOT EDIT.

// Package static is generated to avoid importing the heavy upgrades package.
package static

// UpgradeNames is the list of supported network upgrade names.
var UpgradeNames = []string{
%s}
`

	content := fmt.Sprintf(tpl, names)
	tutil.RequireGoldenBytes(t, []byte(content), tutil.WithFilename("../static/static_gen.go"))
}
